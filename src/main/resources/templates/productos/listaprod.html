<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Productos / Inventario | Alemandan POS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/assets/css/dashboard_admin.css}">
    <link rel="stylesheet" th:href="@{/assets/css/panel_tablas.css}">
    <link rel="stylesheet" th:href="@{/assets/css/productos_cards.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<header class="admin-header">
    <div class="header-left">
        <img th:src="@{/assets/img/Alogo.png}" alt="Alemandan Logo" class="admin-logo" id="logoBtn" title="Menú">
        <span class="admin-title">ADMINISTRADOR</span>
    </div>
    <div class="header-actions">
        <a href="/admin/correos-masivos" class="header-btn"><i class="fas fa-envelope"></i> Enviar correos</a>
        <form th:action="@{/logout}" method="post" class="header-btn logout-form">
            <button type="submit"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</button>
        </form>
    </div>
</header>

<aside class="sidebar hide" id="sidebar">
    <nav>
        <ul>
            <li><a href="/dashboard"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="/usuarios"><i class="fas fa-users"></i> Usuarios</a></li>
            <li><a href="/productos" class="active"><i class="fas fa-boxes"></i> Productos / Inventario</a></li>
            <li><a href="/proveedores"><i class="fas fa-truck"></i> Proveedores</a></li>
            <li><a href="/admin/ventas"><i class="fas fa-shopping-cart"></i> Ventas</a></li>
        </ul>
    </nav>
</aside>

<main class="dashboard-main">
    <section class="panel-card">
        <div class="panel-header" style="display:flex; justify-content:space-between; align-items:center;">
            <h1><i class="fas fa-boxes"></i> Productos / Inventario</h1>
            <div class="panel-actions" style="display:flex; align-items:center; gap:12px;">
                <div class="filter-wrap">
                    <label for="filtroCategoria">Filtrar por categoría:</label>
                    <select id="filtroCategoria">
                        <option value="">Todos</option>
                        <option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.nombre}"></option>
                    </select>
                </div>
                <a href="/productos/nuevo" class="add-btn"><i class="fas fa-plus"></i> Agregar Producto</a>
            </div>
        </div>

        <div class="tabla-bg">
            <div class="productos-grid">
                <div class="producto-card" th:each="producto : ${productos}"
                     th:attr="data-categoria-id=${producto.categoria != null ? producto.categoria.id : ''}">
                    <div class="card-img">
                        <img th:if="${producto.imagePath != null}" th:src="${producto.imagePath}"
                             th:alt="${producto.nombre}" onerror="this.onerror=null;this.src='/assets/img/default.png';" />
                        <img th:unless="${producto.imagePath != null}" th:src="@{/assets/img/default.png}" th:alt="${producto.nombre}" />
                    </div>
                    <div class="card-body">
                        <h4 th:text="${producto.nombre}">Nombre</h4>

                        <!-- Categoría: muestra el nombre real de la categoría -->
                        <p><strong>Categoría:</strong>
                            <span th:text="${producto.categoria != null ? producto.categoria.nombre : 'Sin categoría'}">Categoria</span>
                        </p>

                        <!-- Cantidad -->
                        <p>
                            <strong>Cantidad:</strong>
                            <span th:text="${producto.cantidad}">0</span>
                        </p>

                        <!-- Medida: nueva línea llamada "Medida", maneja String o entidad -->
                        <p>
                            <strong>Medida:</strong>
                            <span th:text="${producto.unidadMedida == null ? '-' :
                                           (producto.unidadMedida instanceof T(java.lang.String) ? producto.unidadMedida :
                                            (producto.unidadMedida.nombre == null ? '-' : producto.unidadMedida.nombre))}">
                                -
                            </span>
                        </p>

                        <p><strong>Precio:</strong> $<span th:text="${producto.precio}">0.00</span></p>
                        <p><strong>Estado:</strong> <span th:text="${producto.activo ? 'Activo' : 'Inactivo'}">Activo</span></p>

                        <div class="card-actions">
                            <a th:href="@{'/productos/editar/' + ${producto.id}}" class="btn-editar"><i class="fas fa-edit"></i> Editar</a>
                            <a th:if="${producto.activo}" th:href="@{'/productos/inactivar/' + ${producto.id}}"
                               class="btn-inactivar" onclick="return confirm('¿Seguro que quieres inactivar este producto?');">
                                <i class="fas fa-ban"></i> Inactivar
                            </a>
                            <a th:unless="${producto.activo}" th:href="@{'/productos/activar/' + ${producto.id}}"
                               class="btn-activar" onclick="return confirm('¿Seguro que quieres activar este producto?');">
                                <i class="fas fa-check"></i> Activar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    const sidebar = document.getElementById('sidebar');
    const logoBtn = document.getElementById('logoBtn');
    if (logoBtn) {
        logoBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hide');
        });
    }

    // Filtrar tarjetas por categoría (cliente-side)
    const filtro = document.getElementById('filtroCategoria');
    if (filtro) {
        filtro.addEventListener('change', () => {
            const selected = filtro.value;
            document.querySelectorAll('.producto-card').forEach(card => {
                const cat = card.getAttribute('data-categoria-id') || '';
                if (!selected || selected === '' || selected === cat) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
</script>
</body>
</html>
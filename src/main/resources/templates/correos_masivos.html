<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Enviar Correos Masivos | Alemandan CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/assets/css/dashboard_admin.css}">
    <link rel="stylesheet" th:href="@{/assets/css/correos_masivos.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<header class="admin-header">
    <div class="header-left">
        <img th:src="@{/assets/img/Alogo.png}" alt="Alemandan Logo" class="admin-logo" id="logoBtn" title="Menú">
        <span class="admin-title">ADMINISTRADOR</span>
    </div>
    <div class="header-actions">
        <form th:action="@{/logout}" method="post" class="header-btn logout-form">
            <button type="submit"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</button>
        </form>
    </div>
</header>

<aside class="sidebar hide" id="sidebar">
    <nav>
        <ul>
            <li><a href="/dashboard"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="/usuarios"><i class="fas fa-users"></i> Usuarios</a></li>
            <li><a href="/productos"><i class="fas fa-boxes"></i> Productos / Inventario</a></li>
            <li><a href="/proveedores"><i class="fas fa-truck"></i> Proveedores</a></li>
            <li><a href="/admin/ventas"><i class="fas fa-shopping-cart"></i> Ventas</a></li>
        </ul>
    </nav>
</aside>

<main class="dashboard-main">
    <section class="correos-card">
        <div class="correos-header">
            <h1><i class="fas fa-envelope"></i> Enviar correos masivos</h1>
        </div>
        <form method="post" th:action="@{/admin/correos-masivos}" class="correos-form">
            <div class="form-group">
                <label for="asunto">Asunto:</label>
                <input type="text" name="asunto" id="asunto" required>
            </div>
            <div class="form-group">
                <label for="mensaje">Mensaje:</label>
                <textarea name="mensaje" id="mensaje" rows="6" required></textarea>
            </div>
            <div class="form-group destinatarios-group">
                <label>Destinatarios:</label>
                <div class="destinatarios-selectores">
                    <button type="button" class="select-btn" onclick="selectAllByRole('all')"><i class="fas fa-users"></i> Todos</button>
                    <button type="button" class="select-btn" onclick="selectAllByRole('EMPLEADO')"><i class="fas fa-user-tie"></i> Empleados</button>
                    <button type="button" class="select-btn" onclick="selectAllByRole('ADMIN')"><i class="fas fa-crown"></i> Administradores</button>
                </div>
                <div class="destinatarios-list" id="destinatarios-list">
                    <label class="destinatario-checkbox" th:each="usuario : ${usuarios}">
                        <input type="checkbox" name="destinatarios"
                               th:value="${usuario.id}"
                               th:attr="data-rol=${usuario.rol}">
                        <span th:text="${usuario.email}"></span>
                        (<span th:text="${usuario.nombre}"></span>)
                        <span class="rol-label" th:text="${usuario.rol == 'ADMIN' ? 'ADMINISTRADOR' : 'EMPLEADO'}"
                              th:classappend="${usuario.rol == 'ADMIN' ? 'rol-admin' : 'rol-empleado'}"></span>
                    </label>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="send-btn"><i class="fas fa-paper-plane"></i> Enviar correos</button>
            </div>
        </form>
        <div th:if="${mensaje}" class="msg-success" th:text="${mensaje}"></div>
        <div th:if="${error}" class="msg-error" th:text="${error}"></div>
    </section>
</main>
<script>
    // Sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const logoBtn = document.getElementById('logoBtn');
    logoBtn.addEventListener('click', () => {
        sidebar.classList.toggle('hide');
    });

    // Selección de destinatarios por rol
    function selectAllByRole(role) {
        const checkboxes = document.querySelectorAll('input[name="destinatarios"]');
        checkboxes.forEach(chk => {
            if (role === 'all') {
                chk.checked = true;
            } else {
                chk.checked = chk.getAttribute('data-rol') === role;
            }
        });
    }
</script>
</body>
</html>
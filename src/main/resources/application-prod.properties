# Production Configuration for Alemandan CRM
# This file is automatically activated when SPRING_PROFILES_ACTIVE=prod
# On Railway, set this environment variable to use these settings

# ==========================================
# Database Configuration - PRODUCTION SAFETY
# ==========================================

# IMPORTANT: Use 'validate' instead of 'update' in production
# This prevents Hibernate from automatically modifying your database schema
# which can cause data loss or conflicts with MySQL strict mode
spring.jpa.hibernate.ddl-auto=validate

# Disable SQL logging in production (improves performance and reduces log spam)
spring.jpa.show-sql=false

# Use optimized dialect for MySQL 8+
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect

# ==========================================
# Performance Optimization
# ==========================================

# Connection pool settings (tuned for Railway constraints)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# Server performance settings
server.tomcat.max-threads=50
server.tomcat.min-spare-threads=10
server.tomcat.accept-count=100

# Enable lazy initialization to reduce startup time and memory
spring.main.lazy-initialization=true

# ==========================================
# Security Settings
# ==========================================

# Enable Thymeleaf cache in production for better performance
# (Disable in development to see template changes without restart)
spring.thymeleaf.cache=true

# ==========================================
# Email Configuration
# ==========================================

# SMTP timeouts (prevent long hangs on Railway where SMTP is blocked)
spring.mail.properties.mail.smtp.connectiontimeout=10000
spring.mail.properties.mail.smtp.timeout=10000
spring.mail.properties.mail.smtp.writetimeout=10000

# ==========================================
# Password Reset Security
# ==========================================

# Tokens expire after 30 minutes (more secure than permanent tokens)
security.password.reset.permanent=false
security.password.reset.token.expiration-minutes=30

# ==========================================
# File Upload Configuration
# ==========================================

# Railway uses /app directory
app.uploads-dir=/app/uploads

# IMPORTANT: Railway filesystem is ephemeral
# Files uploaded will be lost on redeploy
# For production, configure AWS S3 or similar cloud storage
# See .env.template for S3 configuration

# ==========================================
# Logging Configuration
# ==========================================

# Reduce log verbosity in production
logging.level.org.springframework.mail=WARN
logging.level.com.alemandan.crm=INFO
logging.level.org.springframework.web.multipart=WARN
logging.level.org.hibernate.SQL=WARN

# Enable logging for critical errors
logging.level.root=WARN

# ==========================================
# Railway-Specific Notes
# ==========================================

# 1. Charts in PDF Exports:
#    - Railway lacks libfreetype.so.6 and other native libraries
#    - Application runs in headless mode (java.awt.headless=true)
#    - Chart generation has fallback: charts skipped, data preserved
#    - For full chart support: Deploy with Docker or install native libs
#
# 2. Email Sending:
#    - Railway blocks SMTP ports (25, 465, 587)
#    - Use SendGrid API (set SENDGRID_API_KEY and SENDER_EMAIL)
#    - Application validates config on startup and logs warnings
#    - Emails fail gracefully - app continues working
#
# 3. Database Schema:
#    - Never use ddl-auto=update in production
#    - Apply schema manually or use Flyway/Liquibase
#    - MySQL strict mode requires valid datetime defaults
#    - See docs/DEPLOYMENT.md for migration strategy
#
# 4. Memory Limits:
#    - Set JAVA_TOOL_OPTIONS=-Xmx512m (or higher based on plan)
#    - Railway Starter: 512MB, Developer: 1GB, Pro: 2GB+
#    - Monitor logs for OutOfMemoryError
#
# 5. File Uploads:
#    - Filesystem is ephemeral (files lost on redeploy)
#    - For persistent storage: Configure AWS S3
#    - See .env.template for S3 configuration

# ==========================================
# Environment Variables Required
# ==========================================

# These must be set in Railway environment variables:
#
# Required:
#   SPRING_DATASOURCE_URL      - JDBC URL from Railway MySQL
#   SPRING_DATASOURCE_USERNAME - Database username
#   SPRING_DATASOURCE_PASSWORD - Database password
#   APP_BASE_URL              - Your Railway deployment URL
#
# Email (choose one):
#   SENDGRID_API_KEY          - SendGrid API key (recommended)
#   SENDER_EMAIL              - Verified SendGrid sender email
#   OR
#   SPRING_MAIL_HOST          - SMTP host (may be blocked)
#   SPRING_MAIL_USERNAME      - SMTP username
#   SPRING_MAIL_PASSWORD      - SMTP password
#
# Optional:
#   JAVA_TOOL_OPTIONS         - JVM memory settings (-Xmx512m)
#   PORT                      - Server port (Railway sets automatically)

# ==========================================
# Activation
# ==========================================

# To use this profile in Railway, set:
# SPRING_PROFILES_ACTIVE=prod
